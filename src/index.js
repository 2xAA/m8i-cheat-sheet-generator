import '../assets/css/styles.css'
import parser from './parser'
import screenWriter from './screen-writer'
const fontPath = require('../assets/fonts/stealth57-webfont.woff')

// if (module.hot) {
//   module.hot.dispose(cleanUp);
// }

// const organ = {'M8 Version Header': {'value': 'M8VERSION\u00001100', 'label': null}, 'Instrument Type': {'value': 1, 'label': 'MACROSYN'}, 'Instrument Name': {'value': 'ORGAN', 'label': null}, 'Transpose': {'value': 1, 'label': 'ON'}, 'Table Tick': {'value': 1, 'label': null}, 'Table': {'value': 'any', 'label': null}, 'Shape': {'value': 39, 'label': 'WAV PARAPHONIC'}, 'Timbre': {'value': 239, 'label': null}, 'Color': {'value': 128, 'label': null}, 'Degrade': {'value': 0, 'label': null}, 'Redux': {'value': 0, 'label': null}, 'Filter': {'value': 0, 'label': 'OFF'}, 'Cutoff': {'value': 209, 'label': null}, 'Resonance': {'value': 128, 'label': null}, 'Amp': {'value': 0, 'label': null}, 'Limit Mode': {'value': 0, 'label': 'CLIP'}, 'Pan': {'value': 128, 'label': null}, 'Dry Volume': {'value': 192, 'label': null}, 'Chorus Send': {'value': 64, 'label': null}, 'Delay Send': {'value': 0, 'label': null}, 'Reverb Send': {'value': 0, 'label': null}, 'Envelope 1 Destination': {'value': 9, 'label': 'AMP'}, 'Envelope 1 Amount': {'value': 6, 'label': null}, 'Envelope 1 Attack': {'value': 0, 'label': null}, 'Envelope 1 Hold': {'value': 16, 'label': null}, 'Envelope 1 Decay': {'value': 48, 'label': null}, 'Envelope 2 Destination': {'value': 0, 'label': 'OFF'}, 'Envelope 2 Amount': {'value': 0, 'label': null}, 'Envelope 2 Attack': {'value': 255, 'label': null}, 'Envelope 2 Hold': {'value': 0, 'label': null}, 'Envelope 2 Decay': {'value': 0, 'label': null}, 'LFO Shape': {'value': 0, 'label': 'TRI'}, 'LFO Destination': {'value': 2, 'label': 'PITCH'}, 'LFO Trigger Mode': {'value': 0, 'label': 'FREE'}, 'LFO Frequency': {'value': 2, 'label': null}, 'LFO Amount': {'value': 1, 'label': null}}

// const sampleString = {'M8 Version Header': {'value': 'M8VERSION\u00001100', 'label': null}, 'Instrument Type': {'value': 2, 'label': 'SAMPLE'}, 'Instrument Name': {'value': 'SAMPLE STRNG', 'label': null}, 'Transpose': {'value': 1, 'label': 'ON'}, 'Table Tick': {'value': 1, 'label': null}, 'Table': {'value': 'any', 'label': null}, 'Detune': {'value': 78, 'label': null}, 'Play Mode': {'value': 0, 'label': 'FWD'}, 'Slices': {'value': 0, 'label': 'OFF'}, 'Start': {'value': 0, 'label': null}, 'Loop Start': {'value': 0, 'label': null}, 'Length': {'value': 255, 'label': null}, 'Degrade': {'value': 0, 'label': null}, 'Filter': {'value': 0, 'label': 'OFF'}, 'Cutoff': {'value': 255, 'label': null}, 'Resonance': {'value': 0, 'label': null}, 'Amp': {'value': 0, 'label': null}, 'Limit Mode': {'value': 0, 'label': 'CLIP'}, 'Pan': {'value': 128, 'label': null}, 'Dry Volume': {'value': 192, 'label': null}, 'Chorus Send': {'value': 0, 'label': null}, 'Delay Send': {'value': 0, 'label': null}, 'Reverb Send': {'value': 0, 'label': null}, 'Envelope 1 Destination': {'value': 0, 'label': 'OFF'}, 'Envelope 1 Amount': {'value': 255, 'label': null}, 'Envelope 1 Attack': {'value': 0, 'label': null}, 'Envelope 1 Hold': {'value': 0, 'label': null}, 'Envelope 1 Decay': {'value': 128, 'label': null}, 'Envelope 2 Destination': {'value': 0, 'label': 'OFF'}, 'Envelope 2 Amount': {'value': 255, 'label': null}, 'Envelope 2 Attack': {'value': 0, 'label': null}, 'Envelope 2 Hold': {'value': 0, 'label': null}, 'Envelope 2 Decay': {'value': 128, 'label': null}, 'LFO Shape': {'value': 0, 'label': 'TRI'}, 'LFO Destination': {'value': 0, 'label': 'OFF'}, 'LFO Trigger Mode': {'value': 0, 'label': 'FREE'}, 'LFO Frequency': {'value': 16, 'label': null}, 'LFO Amount': {'value': 255, 'label': null}, 'Sample file-path': {'value': '/Samples/Acoustic/Strings/String-Ensemble-maj-c4.wav', 'label': null}}

// const midiEmpty = {'M8 Version Header': {'value': 'M8VERSION\u00001100', 'label': null}, 'Instrument Type': {'value': 3, 'label': 'MIDI OUT'}, 'Instrument Name': {'value': 'MIDI EMPTY', 'label': null}, 'Transpose': {'value': 1, 'label': 'ON'}, 'Table Tick': {'value': 1, 'label': null}, 'Table': {'value': 'any', 'label': null}, 'MIDI Channel': {'value': 0, 'label': '001'}, 'MIDI Program Bank': {'value': 0, 'label': '---'}, 'MIDI Program Change': {'value': 0, 'label': '---'}, 'MIDI CC A Control': {'value': 0, 'label': '---'}, 'MIDI CC A Value': {'value': 255, 'label': '---'}, 'MIDI CC B Control': {'value': 0, 'label': '---'}, 'MIDI CC B Value': {'value': 255, 'label': '---'}, 'MIDI CC C Control': {'value': 0, 'label': '---'}, 'MIDI CC C Value': {'value': 255, 'label': '---'}, 'MIDI CC D Control': {'value': 0, 'label': '---'}, 'MIDI CC D Value': {'value': 255, 'label': '---'}, 'MIDI CC E Control': {'value': 0, 'label': '---'}, 'MIDI CC E Value': {'value': 255, 'label': '---'}, 'MIDI CC F Control': {'value': 0, 'label': '---'}, 'MIDI CC F Value': {'value': 255, 'label': '---'}, 'MIDI CC G Control': {'value': 0, 'label': '---'}, 'MIDI CC G Value': {'value': 255, 'label': '---'}, 'MIDI CC H Control': {'value': 0, 'label': '---'}, 'MIDI CC H Value': {'value': 255, 'label': '---'}, 'MIDI CC I Control': {'value': 0, 'label': '---'}, 'MIDI CC I Value': {'value': 255, 'label': '---'}, 'MIDI CC J Control': {'value': 255, 'label': '---'}, 'MIDI CC J Value': {'value': 255, 'label': '---'}}

const wavsynthTable = {'M8 Version Header': {'value': 'M8VERSION\u00001100', 'label': null}, 'Instrument Type': {'value': 0, 'label': 'WAVSYNTH'}, 'Instrument Name': {'value': 'WAVSYNTHPU12', 'label': null}, 'Transpose': {'value': 1, 'label': 'ON'}, 'Table Tick': {'value': 1, 'label': null}, 'Table Row 1 Note Transpose': {'value': 255, 'label': null}, 'Table Row 1 Note Volume': {'value': 127, 'label': null}, 'Table Row 1 CMD1': {'value': 0, 'label': 'ARP'}, 'Table Row 1 CMD1 Value': {'value': 240, 'label': null}, 'Table Row 1 CMD2': {'value': 16, 'label': 'VMV'}, 'Table Row 1 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 1 CMD3': {'value': 129, 'label': 'PIT'}, 'Table Row 1 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 2 Note Transpose': {'value': 0, 'label': null}, 'Table Row 2 Note Volume': {'value': 255, 'label': null}, 'Table Row 2 CMD1': {'value': 1, 'label': 'CHA'}, 'Table Row 2 CMD1 Value': {'value': 224, 'label': null}, 'Table Row 2 CMD2': {'value': 17, 'label': 'XCM'}, 'Table Row 2 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 2 CMD3': {'value': 130, 'label': 'FIN'}, 'Table Row 2 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 3 Note Transpose': {'value': 243, 'label': null}, 'Table Row 3 Note Volume': {'value': 255, 'label': null}, 'Table Row 3 CMD1': {'value': 2, 'label': 'DEL'}, 'Table Row 3 CMD1 Value': {'value': 208, 'label': null}, 'Table Row 3 CMD2': {'value': 18, 'label': 'XCF'}, 'Table Row 3 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 3 CMD3': {'value': 131, 'label': 'OSC'}, 'Table Row 3 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 4 Note Transpose': {'value': 0, 'label': null}, 'Table Row 4 Note Volume': {'value': 255, 'label': null}, 'Table Row 4 CMD1': {'value': 3, 'label': 'GRV'}, 'Table Row 4 CMD1 Value': {'value': 192, 'label': null}, 'Table Row 4 CMD2': {'value': 19, 'label': 'XCW'}, 'Table Row 4 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 4 CMD3': {'value': 132, 'label': 'SIZ'}, 'Table Row 4 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 5 Note Transpose': {'value': 231, 'label': null}, 'Table Row 5 Note Volume': {'value': 255, 'label': null}, 'Table Row 5 CMD1': {'value': 4, 'label': 'HOP'}, 'Table Row 5 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 5 CMD2': {'value': 20, 'label': 'XCR'}, 'Table Row 5 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 5 CMD3': {'value': 133, 'label': 'MUL'}, 'Table Row 5 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 6 Note Transpose': {'value': 0, 'label': null}, 'Table Row 6 Note Volume': {'value': 255, 'label': null}, 'Table Row 6 CMD1': {'value': 5, 'label': 'KIL'}, 'Table Row 6 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 6 CMD2': {'value': 21, 'label': 'XDT'}, 'Table Row 6 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 6 CMD3': {'value': 134, 'label': 'WRP'}, 'Table Row 6 CMD3 Value': {'value': 96, 'label': null}, 'Table Row 7 Note Transpose': {'value': 219, 'label': null}, 'Table Row 7 Note Volume': {'value': 255, 'label': null}, 'Table Row 7 CMD1': {'value': 6, 'label': 'RAN'}, 'Table Row 7 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 7 CMD2': {'value': 22, 'label': 'XDF'}, 'Table Row 7 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 7 CMD3': {'value': 135, 'label': 'MIR'}, 'Table Row 7 CMD3 Value': {'value': 80, 'label': null}, 'Table Row 8 Note Transpose': {'value': 0, 'label': null}, 'Table Row 8 Note Volume': {'value': 255, 'label': null}, 'Table Row 8 CMD1': {'value': 7, 'label': 'RET'}, 'Table Row 8 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 8 CMD2': {'value': 23, 'label': 'XDW'}, 'Table Row 8 CMD2 Value': {'value': 80, 'label': null}, 'Table Row 8 CMD3': {'value': 136, 'label': 'FIL'}, 'Table Row 8 CMD3 Value': {'value': 64, 'label': null}, 'Table Row 9 Note Transpose': {'value': 207, 'label': null}, 'Table Row 9 Note Volume': {'value': 127, 'label': null}, 'Table Row 9 CMD1': {'value': 8, 'label': 'REP'}, 'Table Row 9 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 9 CMD2': {'value': 24, 'label': 'XDR'}, 'Table Row 9 CMD2 Value': {'value': 64, 'label': null}, 'Table Row 9 CMD3': {'value': 137, 'label': 'CUT'}, 'Table Row 9 CMD3 Value': {'value': 48, 'label': null}, 'Table Row 10 Note Transpose': {'value': 0, 'label': null}, 'Table Row 10 Note Volume': {'value': 255, 'label': null}, 'Table Row 10 CMD1': {'value': 9, 'label': 'PSL'}, 'Table Row 10 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 10 CMD2': {'value': 25, 'label': 'XRS'}, 'Table Row 10 CMD2 Value': {'value': 48, 'label': null}, 'Table Row 10 CMD3': {'value': 138, 'label': 'RES'}, 'Table Row 10 CMD3 Value': {'value': 32, 'label': null}, 'Table Row 11 Note Transpose': {'value': 195, 'label': null}, 'Table Row 11 Note Volume': {'value': 79, 'label': null}, 'Table Row 11 CMD1': {'value': 10, 'label': 'PVB'}, 'Table Row 11 CMD1 Value': {'value': 64, 'label': null}, 'Table Row 11 CMD2': {'value': 26, 'label': 'XRD'}, 'Table Row 11 CMD2 Value': {'value': 32, 'label': null}, 'Table Row 11 CMD3': {'value': 139, 'label': 'AMP'}, 'Table Row 11 CMD3 Value': {'value': 16, 'label': null}, 'Table Row 12 Note Transpose': {'value': 0, 'label': null}, 'Table Row 12 Note Volume': {'value': 255, 'label': null}, 'Table Row 12 CMD1': {'value': 11, 'label': 'PVX'}, 'Table Row 12 CMD1 Value': {'value': 48, 'label': null}, 'Table Row 12 CMD2': {'value': 27, 'label': 'XRM'}, 'Table Row 12 CMD2 Value': {'value': 16, 'label': null}, 'Table Row 12 CMD3': {'value': 140, 'label': 'LIM'}, 'Table Row 12 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 13 Note Transpose': {'value': 183, 'label': null}, 'Table Row 13 Note Volume': {'value': 255, 'label': null}, 'Table Row 13 CMD1': {'value': 12, 'label': 'TBL'}, 'Table Row 13 CMD1 Value': {'value': 32, 'label': null}, 'Table Row 13 CMD2': {'value': 28, 'label': 'XRF'}, 'Table Row 13 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 13 CMD3': {'value': 141, 'label': 'PAN'}, 'Table Row 13 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 14 Note Transpose': {'value': 0, 'label': null}, 'Table Row 14 Note Volume': {'value': 255, 'label': null}, 'Table Row 14 CMD1': {'value': 13, 'label': 'THO'}, 'Table Row 14 CMD1 Value': {'value': 16, 'label': null}, 'Table Row 14 CMD2': {'value': 29, 'label': 'XRW'}, 'Table Row 14 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 14 CMD3': {'value': 142, 'label': 'DRY'}, 'Table Row 14 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 15 Note Transpose': {'value': 171, 'label': null}, 'Table Row 15 Note Volume': {'value': 31, 'label': null}, 'Table Row 15 CMD1': {'value': 14, 'label': 'TIC'}, 'Table Row 15 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 15 CMD2': {'value': 30, 'label': 'XRZ'}, 'Table Row 15 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 15 CMD3': {'value': 143, 'label': 'SCH'}, 'Table Row 15 CMD3 Value': {'value': 0, 'label': null}, 'Table Row 16 Note Transpose': {'value': 0, 'label': null}, 'Table Row 16 Note Volume': {'value': 255, 'label': null}, 'Table Row 16 CMD1': {'value': 15, 'label': 'TPO'}, 'Table Row 16 CMD1 Value': {'value': 0, 'label': null}, 'Table Row 16 CMD2': {'value': 128, 'label': 'VOL'}, 'Table Row 16 CMD2 Value': {'value': 0, 'label': null}, 'Table Row 16 CMD3': {'value': 144, 'label': 'SDL'}, 'Table Row 16 CMD3 Value': {'value': 0, 'label': null}, 'Shape': {'value': 0, 'label': 'PULSE 12%'}, 'Size': {'value': 32, 'label': null}, 'Multiply': {'value': 0, 'label': null}, 'Warp': {'value': 0, 'label': null}, 'Mirror': {'value': 0, 'label': null}, 'Filter': {'value': 0, 'label': 'OFF'}, 'Cutoff': {'value': 255, 'label': null}, 'Resonance': {'value': 0, 'label': null}, 'Amp': {'value': 0, 'label': null}, 'Limit Mode': {'value': 0, 'label': 'CLIP'}, 'Pan': {'value': 128, 'label': null}, 'Dry Volume': {'value': 192, 'label': null}, 'Chorus Send': {'value': 0, 'label': null}, 'Delay Send': {'value': 0, 'label': null}, 'Reverb Send': {'value': 0, 'label': null}, 'Envelope 1 Destination': {'value': 0, 'label': 'OFF'}, 'Envelope 1 Amount': {'value': 255, 'label': null}, 'Envelope 1 Attack': {'value': 0, 'label': null}, 'Envelope 1 Hold': {'value': 0, 'label': null}, 'Envelope 1 Decay': {'value': 128, 'label': null}, 'Envelope 2 Destination': {'value': 0, 'label': 'OFF'}, 'Envelope 2 Amount': {'value': 0, 'label': null}, 'Envelope 2 Attack': {'value': 255, 'label': null}, 'Envelope 2 Hold': {'value': 0, 'label': null}, 'Envelope 2 Decay': {'value': 0, 'label': null}, 'LFO Shape': {'value': 0, 'label': 'TRI'}, 'LFO Destination': {'value': 0, 'label': 'OFF'}, 'LFO Trigger Mode': {'value': 0, 'label': 'FREE'}, 'LFO Frequency': {'value': 16, 'label': null}, 'LFO Amount': {'value': 255, 'label': null}}

console.log(wavsynthTable)

const dropArea = document.getElementById('app')
const canvas = document.getElementById('canvas')

dropArea.addEventListener('dragover', e => {
  e.preventDefault()
})

dropArea.addEventListener('drop', e => {
  e.preventDefault()

  const file = event.dataTransfer.files[0]

  const reader = new FileReader()

  reader.onload = () => {
    const arrayBuffer = reader.result

    const byteArray = [...new Uint8Array(arrayBuffer)]
    console.log(byteArray)

    const parsed = parser(byteArray)
    console.log(parsed)

    screenWriter(canvas, parsed)
  }

  reader.readAsArrayBuffer(file)
})

const myFont = new FontFace('stealth57', `url("${fontPath}")`)

let ascending = true

window.addEventListener('keypress', () => {
  wavsynthTable.Pan.value += ascending ? 1 : -1

  if (wavsynthTable.Pan.value === 255 && ascending) {
    ascending = !ascending
  } else if (wavsynthTable.Pan.value === 0 && !ascending) {
    ascending = !ascending
  }

  screenWriter(canvas, wavsynthTable)
})

myFont.load().then((font) => {
  document.fonts.add(font)

  screenWriter(canvas, wavsynthTable)
})
